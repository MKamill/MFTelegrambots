import sqlite3 as lite
import work_with_connection as connection


# @connection.bot.message_handler(content_types=["text"])
# def start_message(message):
#     try:
#         connection.bot.send_message(message.chat.id, message.text)
#     except:
#         connection.bot.send_message(message.chat.id, '–ø—Ä–æ–±—É—é –∑–∞–Ω–æ–≤–æ')
#         try:
#             start_message(message)
#         except:
#             connection.bot.send_message(message.chat.id, '—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –æ—à–∏–±–∫–∞')


def main_search(ch_id):
    connection.bot.send_message(ch_id, '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å–∫–æ–º–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ üîé')

    @connection.bot.message_handler(content_types=['text'])
    def search_photo(message):
        try:
            conn = lite.connect(r'/storage/emulated/0/telegram/documents/photos.db')
            cursor = conn.cursor()
            status_of_proc = False

            cursor.execute("SELECT name FROM img")
            all_names = cursor.fetchall()
            connection.bot.send_message(message.chat.id, all_names)

            for name in all_names:
                if name == message.text:
                    status_of_proc = True
            if status_of_proc:
                name_of_photo = message.text
            else:
                connection.bot.send_message(message.chat.id, '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –¥–∞–Ω–Ω–æ–º—É —Ç–µ–≥—É')

            """–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∏—Å–∫–æ–º–∞—è –∏–Ω—Ñ–∞ –≤ –±–∞–∑–µ –∏–Ω–∞—á–µ –ø–µ—Ä–µ—Å–ø—Ä–æ—Å–∏—Ç—å
            –æ—à–∏–±–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –∞–±–æ—Ä—Ç"""

            sql = "SELECT path FROM img WHERE name=?"
            cursor.execute(sql, [name_of_photo])
            path = cursor.fetchone()
            doc = open(fr'{path}'.replace('(', '').replace(')', '').replace('\'', '').replace(',', ''), 'rb')
            connection.bot.send_photo(message.chat.id, doc)
            return
        except:
            try:
                search_photo(message)
                return
            except:
                connection.bot.send_message(message.chat.id, '—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –æ—à–∏–±–∫–∞')
                return
